# AlgorithmicTrader

## Introduction
This is a project created by Elias Izmirlian, and aims to classify whether a stock's closing price will go up by at least 1% or not in three days. The stock market has always been considered a tough problem for AI systems to tackle due to its complex and volatile nature. There is a massive number of factors which influence price movements in the stock market, so the capabilities of a stochastic model in modeling these movements are limited. However, if the stock market is truly random as the Random Walk Theory describes, meaning historical prices have no influence on current prices, then the collective of people making investing decisions which drive the market must be making decisions purely randomly, which we know to be untrue. With the capabilities of modern AI, there are multiple methods of information capture and analyses which could serve to simplify the human thought that often dictates the market. I wanted to simplify the problem of predicting price movement as much as possible, therefore I aimed to model short term changes as they were easier to observe, but wanted a prediction window of at least a few days because these price movements are less likely to be as erratic as single-day changes. I also decided that trying to classify stocks as having any upwards or downwards movement in closing price three days into the future was too difficult, as then the classifier would need to be sensitive to very minute changes.
Note that I do not recommend using this system in order to make financial traiding decisions, it is more of a test of the capabilities of some of the modern AI tools at our disposal. While the initial results have shown some promise (around 70% accuracy on the small group of stocks I have tested it on), further testing is required to determine with what accuracy the system can be sensitive to stocks with incoming upwards price movement.

## Libraries Used
This project makes use of pytorch, sklearn, yfinance, openai, BeautifulSoup4, numpy, pandas, joblib, matplotlib, and some built-in python libraries such as datetime, csv, time, json, math, and statistics

## Three Layers of Analyses
When explaining how this system makes classification decisions/predictions, I would break it down into three layers. First, there is a pytorch bidirectional LSTM model which is trained on individual stocks. The specifics of the model are defined in lstm_toolkit.py. Recently trained models are saved in the lstm_models directory in order to save on the time it would take to retrain them. The models are trained in lstm.py, and the training and storing models is handled by lstm_controller.py. These LSTM models are trained on 5 years worth of stock closing price history, which is formatted so an 80 day window of closing prices is given as input, and the closing price of the day directly after the window is the expected ouput. The trained models are then used to generate three days of predictions (with the latter two days using predicted closing prices as an input). The methods responsible for generating predictions is also in lstm.py - these methods leverage MonteCarlo Dropout in order to get a more averaged and stable prediction. 
The second layer is sentiment analysis. Most of the work my system does for this portion is webscraping financial news. The financial news is pulled from Bloomberg and Charles Schwab Market Updates using BeautifulSoup4 as an html parser. Market-wide news and stock specific news are pulled from the Schwab Market Update, while Bloombeg financial news is used only for stock specific news. Once relevamt news has been scraped and cleaned, it is passed to openAI's chatgpt-3.5-turbo model and is prompted to act as a sentiment analyzer for financial news, with certain specifications ensuring the outputted message is in the correct format. Note that I had the free version of access to openAPI's chatGPT, which comes with the restriction of making requests no more than 3 times per minute. Due to this restriction, I had to put in stops where the program would wait for 60 seconds in order to avoid getting an error response from openai. However, collected scores are saved in respective jsons for market scores and stock-specific scores, so this does not need to be run multiple times for the same dates.
The final layer of analysis is purely statistical - helper_stats.py contains a number of methods to return values like momentum, volatility, bollinger highs/lows based on the ten-day price history. This file is also responsible for labeling datapoints for the SVM.

These three layers are used to glean different forms of information from multiple sources, and all this information is assembled into an input vector for an sklearn SVM to classify. The data which the SVM is fit on is generated in svm_data_generation.py. This file also facilitates collecting sentiment scores, which are stored in json format in market_sent_score_history.dat and stock_sent_score_history.dat for market scores and stock scores respectively. svm_data_generation assembles the dataset by invoking the previously outlined portions for previous dates and labeling the data. All labeled data is stored in svm_data.dat. The earliest datapoint is from 7/11/2023 and the latest is from 8/17/2023. The stocks included in this dataset are Google, Microsoft, Quanta Services, Meta, Amazon, Apple, Tesla, AT&T, Advanced Micro Devices, Coca-Cola, Disney, Nvidia, Intel Company, Chevron, Exxon Mobile, Ford, Roku, Proctor&Gamble, and Sunrun. However, everything is set up so more datapoints can easily be added for a larger date range and for more stocks.
The svm data is fit on an svm in svm.py. In this file, there are also methods to test the classifier on stocks/days which are not included in the dataset, as well as a method to predict the price movement for the next three days.

## Results

The system has only been tested on a subset of stocks that the svm was fit on, typically Google, Microsoft, Amazon, Meta, Coca-Cola, Nvidia, and Advanced Micro Devices. I would say when the system predicts a stock is going to go up, it is quite accurate (75 - 80% accuracy on test sets), but it is not very sensitive to every stock which is going to go up. It is more conservative, and biased to classify stocks as going down or staying the same. For example, on a test set of 7 stocks tested on 5 different dates, the system correctly classified only 3/23 stocks which had closing price increases 3 days later of 1% or more. It correctly classified 11/12 stock which were decreasing or staying the same. When the system predicted a stock was going to increase, it did increase 3/4 times, and when the system predicted a stock was going to stay the same or decrease, the stock actually did decrease or stay the same 11/31 times. So from this (and further testing), it seems clear that the model is strongly biased to classify stocks as going down or staying the same. This could be influenced by the fact that there is more data collected for stocks going down or staying the same (this is partly due to the nature of the market and partly due to the period of time during which I was collecting data). Further analysis needs to be conducted on what circumstances surround correct inferences of stocks going up.

## How to Use

If you've made it this far into the README, then you can probably assume I do not recommend using this system to make financial trading decisions. There is still a lot of testing and improvement to be done. That being said, if you would like to test it out for yourself, here are the steps you would need to take:
    You MUST set your openAI API key in config.py
    If you have a paid account, set free_version to False as well
    Then, navigate to svm.py and set the tickers you want prediction for
    If you are testing the classifier, set the dates you want it tested on as well
    Run svm.py